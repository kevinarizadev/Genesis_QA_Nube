"use strict";!function(e){e.module("ng-dropdown",[]).service("DropdownService",["$document",function(n){var t=this;this.dropdowns=[],this.open=function(e){var n=this,t=this.dropdowns[e];t.opened||((this.currentlyOpen||0===this.currentlyOpen)&&this.close(this.currentlyOpen),t.element.addClass(t.activeClass),t.menuElement.addClass(t.openClass),t.opened=!0,setTimeout(function(){return n.currentlyOpen=e},0))},this.close=function(e){var n=this.dropdowns[e];n.opened&&(n.element.removeClass(n.activeClass),n.menuElement.removeClass(n.openClass),n.opened=!1,delete this.currentlyOpen,delete n.options,this.clearCurrentOption(n))},this.disable=function(e){var n=this.dropdowns[e];n.element.addClass("dropdown-disabled"),n.disabled=!0},this.enable=function(e){var n=this.dropdowns[e];n.element.removeClass("dropdown-disabled"),n.disabled=!1},this.toggle=function(e){var n=this.dropdowns[e];n.opened?this.close(e):this.open(e)},this.documentClickHandler=function(){var e=this;return function(n){if(e.currentlyOpen||0===e.currentlyOpen){var t=e.dropdowns[e.currentlyOpen];t.menuElement===n.target||t.disableDocumentClick||e.close(e.currentlyOpen)}}},n.bind("click",this.documentClickHandler()),this.clickHandler=function(e){var n=this;return function(t){e.disabled||e.disableClick||n.toggle(e.id)}},this.focusHandler=function(e){var n=this;return function(){return n.currentlyFocused=e}},this.blurHandler=function(){return delete t.currentlyFocused},this.clearCurrentOption=function(e){e.currentOption&&(e.currentOption.removeClass(e.activeClass),delete e.currentOption)},this.mouseenterHandler=function(e){var n=this;return function(){n.clearCurrentOption(e),e.isInsideMenu=!0}},this.mouseleaveHandler=function(e){return function(){return e.isInsideMenu=!1}},this.populateOptions=function(n){n.options=Array.prototype.map.call(n.menuElement.children(),function(n){return e.element(n)}),n.currentOption=e.element(n.options[0])},this.activateNextOption=function(e){if(this.open(e.id),e.options){var n=e.options.indexOf(e.currentOption)+1;this.clearCurrentOption(e),e.currentOption=e.options.length>n?e.options[n]:e.options[0]}else this.populateOptions(e);e.currentOption.addClass(e.activeClass),e.menuElement[0].scrollTop=e.currentOption.offsetTop},this.activatePreviousOption=function(e){if(this.open(e.id),e.options){var n=e.options.indexOf(e.currentOption)-1;this.clearCurrentOption(e),e.currentOption=n>=0?e.options[n]:e.options[e.options.length-1]}else this.populateOptions(e);e.currentOption.addClass(e.activeClass),e.menuElement[0].scrollTop=e.currentOption.offsetTop},this.keyupHandler=function(e){var n=this;return function(t){var o=document.activeElement===e.fieldElement[0];e.disabled||!e.opened&&!o||-1===[9,27,40,38,13].indexOf(t.keyCode)||(t.preventDefault(),t.stopPropagation(),27===t.keyCode?n.close(e.id):40===t.keyCode?n.activateNextOption(e):38===t.keyCode?n.activatePreviousOption(e):13===t.keyCode&&(e.currentOption&&e.opened&&o?e.currentOption[0].click():!e.opened&&o&&n.open(e.id)))}},this.keydownHandler=function(e){var n=this;return function(t){e.opened&&9===t.keyCode&&n.close(e.id)}}}]).directive("dropdown",["$parse","DropdownService",function(n,t){return{restrict:"A",scope:{dropdown:"=?",disabled:"=?dropdownDisabled"},link:function(n,o,i){var r,s=i.dropdownOpenClass||"open",d=i.dropdownActiveClass||"active",l=o[0].querySelector("[dropdown-menu]"),u=o[0].querySelector("[dropdown-field]");r={id:t.dropdowns.length,activeClass:d,openClass:s,element:o,fieldElement:e.element(u),menuElement:e.element(l)},n.dropdown=t.dropdowns[r.id]=r,n.$watch("disabled",function(e){e?t.disable(r.id):t.enable(r.id)}),o.bind("click",t.clickHandler(r)),o.bind("focus",t.focusHandler(r)),o.bind("blur",t.blurHandler),r.menuElement.bind("mouseenter",t.mouseenterHandler(r)),r.menuElement.bind("mouseleave",t.mouseleaveHandler(r)),r.fieldElement.bind("keyup",t.keyupHandler(r)),r.fieldElement.bind("keydown",t.keydownHandler(r))}}}])}(window.angular);